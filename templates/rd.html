{% extends "base.html" %}
{% block title %}Recurring Deposit{% endblock %}
{% block content %}
<div class="page-header">
    <div>
        <h2>Recurring Deposit (RD)</h2>
        <p class="page-subtitle">Open, manage installments, and close RDs</p>
    </div>
    <button type="button" class="btn-secondary" onclick="window.history.back()">Back</button>
</div>

<div class="page-tools">
    <a href="{{ url_for('rd_statement') }}" class="btn-secondary">View Statement</a>
</div>

<div class="split-grid">
    <form method="post" class="card form-grid">
        <h3>RD Open</h3>
        <input type="hidden" name="action" value="open">
        <div class="form-row">
            <label>Account No
                <input type="text" name="account_no" required>
            </label>
            <label>Start Date
                <input type="date" name="start_date" value="{{ now.date() }}">
            </label>
        </div>
        <div class="form-row">
            <label>Monthly Installment
                <input type="number" step="0.01" name="installment_amount" required>
            </label>
            <label>Period (Months)
                <input type="number" name="period_months" required>
            </label>
        </div>
        <div class="form-row">
            <label>Interest Rate (% optional)
                <input type="number" step="0.01" name="interest_rate">
            </label>
        </div>
        <div class="form-row">
            <label>Remarks
                <textarea name="remarks" rows="2"></textarea>
            </label>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn-primary">Open RD</button>
            <button type="reset" class="btn-secondary">Clear</button>
        </div>
    </form>

    <form method="post" class="card form-grid">
        <h3>RD Installment Received</h3>
        <input type="hidden" name="action" value="installment">
        <div class="form-row">
            <label>RD ID
                <input type="text" name="rd_id" required>
            </label>
            <label>Date
                <input type="date" name="date" value="{{ now.date() }}">
            </label>
        </div>
        <div class="form-row">
            <label>Amount
                <input type="number" step="0.01" name="amount">
            </label>
        </div>
        <div class="form-row">
            <label>Remarks
                <textarea name="remarks" rows="2"></textarea>
            </label>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn-primary">Record Installment</button>
        </div>
    </form>
</div>

<form method="post" class="card form-grid">
    <h3>RD Close</h3>
    <input type="hidden" name="action" value="close">
    <div class="form-row">
        <label>RD ID
            <input type="text" name="rd_id_close" required>
        </label>
        <label>Close Date
            <input type="date" name="close_date" value="{{ now.date() }}">
        </label>
    </div>
    <div class="form-row">
        <label>Amount Paid
            <input type="number" step="0.01" name="amount_paid" required>
        </label>
        <label>Remarks
            <textarea name="remarks" rows="2"></textarea>
        </label>
    </div>
    <div class="form-actions">
        <button type="submit" class="btn-primary">Close RD</button>
    </div>
</form>

<div class="card table-card">
    <h3>Recent RDs</h3>
    <div class="table-wrapper">
        <table>
            <thead>
            <tr>
                <th>Account</th>
                <th>Name</th>
                <th>Start</th>
                <th>Installment</th>
                <th>Period</th>
                <th>Maturity Date</th>
                <th>Maturity Amount</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody>
            {% for r in rds %}
                <tr>
                    <td>{{ r.account_no }}</td>
                    <td>{{ r.member_name }}</td>
                    <td>{{ r.start_date }}</td>
                    <td>{{ "%.2f"|format(r.installment_amount) }}</td>
                    <td>{{ r.period_months }}</td>
                    <td>{{ r.maturity_date }}</td>
                    <td>{{ "%.2f"|format(r.maturity_amount) }}</td>
                    <td>{{ 'Closed' if r.is_closed else 'Open' }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
